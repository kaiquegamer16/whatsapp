<!DOCTYPE html>
<html>
<head>
    <title>Notificações Desktop com JavaScript</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }

        button:hover {
            background-color: #3e8e41;
        }
    </style>
</head>
<body>

    <h1>Notificações Desktop com JavaScript</h1>

    <button id="enviarNotificacao">Enviar Notificação de Teste</button>

    <script>
        // Verificação e solicitação de permissão
        async function initNotifications() {
            if (!("Notification" in navigator)) {
                console.log('Este navegador não suporta notificações desktop');
                alert('Este navegador não suporta notificações desktop');
                return false; // Indicating that notifications are not supported
            } else {
                if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    // Pede ao usuário para permitir a Notificação Desktop
                    const permission = await Notification.requestPermission();

                    if (permission === 'granted') {
                        console.log('Permissão de notificação concedida.');
                    } else {
                        console.log('Permissão de notificação negada.');
                        alert('Permissão de notificação negada.');
                        return false; // Indicating that notifications are not allowed
                    }
                } else if (Notification.permission === 'denied') {
                    console.log('Permissão de notificação já negada.');
                    alert('Permissão de notificação já negada.');
                    return false; // Indicating that notifications are not allowed
                } else {
                    console.log('Permissões de notificação já concedidas.');
                    return true; // Indicating that notifications are allowed
                }
            }

            return Notification.permission === 'granted';
        }

        // Enviar a notificação
        function sendNotification(title, body) {
            if (Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: '/assets/icons/android-chrome-192x192.png' // Substitua pelo seu ícone
                });

                notification.onclick = (e) => {
                    e.preventDefault();
                    window.focus();
                    notification.close();
                }
            } else {
                console.warn('Permissão de notificação não concedida.');
                alert('Permissão de notificação não concedida.');
            }
        }

        // Inicializar notificações e configurar o botão
        document.addEventListener('DOMContentLoaded', async () => {
            const notificationsAllowed = await initNotifications();

            const botaoEnviar = document.getElementById('enviarNotificacao');
            if (notificationsAllowed) {
                botaoEnviar.addEventListener('click', () => {
                    const titulo = 'Novo Conteúdo!';
                    const mensagem = 'Confira as últimas novidades no nosso site.';
                    sendNotification(titulo, mensagem);
                });
            } else {
                botaoEnviar.disabled = true;
                botaoEnviar.innerText = 'Notificações Não Suportadas/Permitidas';
            }
        });
    </script>

</body>
</html>